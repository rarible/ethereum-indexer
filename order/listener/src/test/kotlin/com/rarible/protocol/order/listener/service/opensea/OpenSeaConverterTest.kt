package com.rarible.protocol.order.listener.service.opensea

import com.rarible.protocol.order.core.misc.toBinary
import com.rarible.protocol.contracts.common.wyvern.atomicizer.WyvernAtomicizer
import com.rarible.protocol.order.listener.integration.AbstractIntegrationTest
import com.rarible.protocol.order.listener.integration.IntegrationTest
import kotlinx.coroutines.FlowPreview
import org.assertj.core.api.Assertions
import org.junit.jupiter.api.Test
import org.springframework.beans.factory.annotation.Autowired

@FlowPreview
@IntegrationTest
class OpenSeaConverterTest(): AbstractIntegrationTest() {

    @Autowired
    private lateinit var openSeaOrderEventConverter: OpenSeaOrderEventConverter

    @Test
    fun test() {
        val input1 = "0x68f0bcaa000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001a0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000088b48f654c30e99bc2e4a1559b4dcf1ad93fa65600000000000000000000000088b48f654c30e99bc2e4a1559b4dcf1ad93fa656000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000c400000000000000000000000000000000000000000000000000000000000000c40000000000000000000000000000000000000000000000000000000000000188f242432a0000000000000000000000007a75e88c1b1f176069417f60dc8368bc69d283c3000000000000000000000000e0645f69d900486f80f294afdcdacbf6ede3eb4b7a75e88c1b1f176069417f60dc8368bc69d283c3000000000000010000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000f242432a0000000000000000000000007a75e88c1b1f176069417f60dc8368bc69d283c3000000000000000000000000e0645f69d900486f80f294afdcdacbf6ede3eb4b7a75e88c1b1f176069417f60dc8368bc69d283c3000000000000020000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000".toBinary()
        val input2 = "0x68f0bcaa00000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000000050000000000000000000000004beb6a1223757db54ac15f78a1233deec50c90370000000000000000000000004beb6a1223757db54ac15f78a1233deec50c90370000000000000000000000004beb6a1223757db54ac15f78a1233deec50c90370000000000000000000000004beb6a1223757db54ac15f78a1233deec50c90370000000000000000000000004beb6a1223757db54ac15f78a1233deec50c903700000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000000640000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000000001f423b872dd0000000000000000000000008ce02b2ef5499199548b4fada95767a61d22962b000000000000000000000000a54d386ab8b606503858a6f56e5127bfd4641978000000000000000000000000000000000000000000000000000000000000000123b872dd0000000000000000000000008ce02b2ef5499199548b4fada95767a61d22962b000000000000000000000000a54d386ab8b606503858a6f56e5127bfd4641978000000000000000000000000000000000000000000000000000000000000001b23b872dd0000000000000000000000008ce02b2ef5499199548b4fada95767a61d22962b000000000000000000000000a54d386ab8b606503858a6f56e5127bfd4641978000000000000000000000000000000000000000000000000000000000000001c23b872dd0000000000000000000000008ce02b2ef5499199548b4fada95767a61d22962b000000000000000000000000a54d386ab8b606503858a6f56e5127bfd4641978000000000000000000000000000000000000000000000000000000000000001d23b872dd0000000000000000000000008ce02b2ef5499199548b4fada95767a61d22962b000000000000000000000000a54d386ab8b606503858a6f56e5127bfd4641978000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000".toBinary()
        val input3 = "0x68f0bcaa0000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000005c000000000000000000000000000000000000000000000000000000000000008600000000000000000000000000000000000000000000000000000000000000014000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe02000000000000000000000000d6ea7aabee72ed26439022ba4b37ff8f6613fe0200000000000000000000000000000000000000000000000000000000000000140000".toBinary()

        val wyvernAtomicizerSig = WyvernAtomicizer.atomicizeSignature()
        val inputList = listOf(input1, input2, input3)

        inputList.forEach{
            val decoded = wyvernAtomicizerSig.`in`().decode(it, 4)
            val inputTransfer = openSeaOrderEventConverter.encodeTransfer(it)
            Assertions.assertThat(inputTransfer).hasSize(decoded.value()._3().size)
            println(inputTransfer.size)
        }
    }
}

